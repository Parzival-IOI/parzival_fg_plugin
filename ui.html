<style>
  body {
    background-color: var(--figma-color-bg);
    color: var(--figma-color-text);
    font-family: sans-serif;
  }
  .container {
    width: 100%;
    height: 100%;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--figma-color-border) var(--figma-color-bg);
  }
  .description {
    width: 100%;
    height: 100px;
    padding: 10px;
    border-radius: 4px;
    border: 1px solid var(--figma-color-border);
    background-color: var(--figma-color-bg);
    color: var(--figma-color-text);
    font-size: 14px;
    resize: none;
    scrollbar-width: thin;
    scrollbar-color: var(--figma-color-border) var(--figma-color-bg);
  }
  .format {
    margin-top: 0.5rem;
    width: 100%;
    height: 40px;
    padding: 10px;
    border-radius: 4px;
    border: 1px solid var(--figma-color-border);
    background-color: var(--figma-color-bg);
    color: var(--figma-color-text);
    font-size: 14px;
  }
  #generate,
  #cancel {
    background-color: var(--figma-color-bg-secondary);
    color: var(--figma-color-text);
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    margin-top: 10px;
  }
  #generate:hover,
  #cancel:hover {
    background-color: var(--figma-color-bg-selected);
  }

  .upload-button, .screen-shot-button {
    display: inline-block;
    padding: 0.5rem 1rem;
    border: 2px solid #b2bec3;
    border-radius: 8px;
    background-color:  var(--figma-color-bg);
    color: var(--figma-color-text);
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    text-align: center;
    transition: background-color 0.3s ease, color 0.3s ease,
    border-color 0.3s ease;
  }

  .upload-button:hover, .screen-shot-button:hover{
    background-color: var(--figma-color-bg-selected);
  }

  .upload-input {
    display: none;
  }

  .hidden{
    display: none;
  }

  div > #upload-image {
    margin-top: 0.5rem;
    width: 10rem;
    height: 10rem;
  }
  #upload-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: 8px;
    border: 0.2rem solid var(--figma-color-text);
  }
  .actions {
    display: flex;
    justify-content: start;
    gap: 1rem;
    align-items: center;
    margin-top: 0.5rem;
  }
</style>

<div class="container">
  <textarea
    class="description"
    name="description"
    id="description"
    rows="5"
    placeholder="Description"
  ></textarea>
  <select class="format" id="format">
    <option value="" selected></option>
    <option value="1">Option 1</option>
    <option value="2">Option 2</option>
  </select>
  <div class="actions">
    <div>
      <label class="upload-button" for="file-upload">Upload a file</label>
      <input type="file" id="file-upload" class="upload-input" />
    </div>
    <button type="button" class="screen-shot-button" id="screenshot">Screen Shot</button>
  </div>
  

  <div>
    <img id="upload-image" src="" alt="" class="hidden" />
  </div>

  <div id="data">data</div>

  <button id="test">test</button>

  <button id="generate">Generate</button>
  <button id="cancel">Cancel</button>
</div>

<script>

  document.getElementById("file-upload").onchange = (event) => {
    const file = event.target.files?.[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const img = document.getElementById(`upload-image`);
        img.classList.remove("hidden");
        img.src = e.target?.result;
        const base64 = e.target?.result;
      };
      reader.readAsDataURL(file);
    }
  }

  document.getElementById("screenshot").onclick = () => {
    parent.postMessage({pluginMessage: { type: 'screenshot' } }, '*')
  };

  document.getElementById("generate").onclick = () => {
    const description = document.getElementById("description").value;
    const format = document.getElementById("format").value;
    const base64 = document.getElementById("upload-image").src;
    parent.postMessage({pluginMessage: { type: 'generate', description, format, base64 } }, '*')
  };

  document.getElementById("cancel").onclick = () => {
    parent.postMessage({ pluginMessage: { type: "cancel" } }, "*");
  };

  document.getElementById("test").onclick = () => {
    console.log("test");
    parent.postMessage({ pluginMessage: { type: "test" } }, "*");
  };

  onmessage = (event) => {

    if (event.data.pluginMessage.type === "image") {
      const base64 = event.data.pluginMessage.image;
      const img = document.getElementById(`upload-image`);
      img.classList.remove("hidden");
      img.src = `data:image/png;base64,${base64}`;
    }
    else if (event.data.pluginMessage.type === "response") {
      const response = event.data.pluginMessage.response;
      const data = document.getElementById("data");
      data.innerHTML = response;
    }
    else if (event.data.pluginMessage.type === "test") {
      const test = event.data.pluginMessage.test;
      console.log(test);
    }
    

    
  };

</script>
